<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Apartment Maintenance Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; margin: 10px; background:#f4f4f4; }
h2, h3 { margin-top:20px; }
.section { background:#fff; padding:12px; margin-bottom:12px; border-radius:6px; }
.row { display:flex; gap:10px; margin-bottom:8px; }
.row label { flex:1; }
.row input, select { flex:1; padding:6px; }
.calc { background:#eef; padding:8px; margin:6px 0; border-radius:4px; font-size:14px; }
button { padding:10px; width:100%; margin-top:10px; }
.topbar { display:flex; justify-content:space-between; align-items:center; }
pre { white-space:pre-wrap; font-family:monospace; }
.hidden { display:none; }
.small { font-size:13px; color:#444; }
hr { border:none; border-top:1px solid #aaa; margin:10px 0; }
</style>
</head>

<body>

<!-- ================= MAIN PAGE ================= -->
<div id="mainPage">

<div class="topbar">
<h2>Maintenance Calculator</h2>
<button onclick="openDefaults()">Set Default</button>
</div>

<div class="section">
<label>Select Month:</label>
<select id="monthSelect"></select>
</div>

<div class="section">
<h3>Budget</h3>
<div class="row">
<label>Amount per house</label>
<input id="budgetPerHouse" type="number">
</div>
<div class="row">
<label>Previous balance</label>
<input id="prevBalance" type="number">
</div>
<div class="calc" id="budgetCalc"></div>
</div>

<div class="section">
<h3>Expenses</h3>

<div class="row">
<label>Sump water amount</label>
<input id="sumpAmt" type="number">
</div>
<div class="row">
<label>No of times</label>
<input id="sumpTimes" type="number">
</div>
<div class="calc" id="sumpCalc"></div>

<div class="row">
<label>Drainage cleaning amount</label>
<input id="drainAmt" type="number">
</div>
<div class="row">
<label>No of times</label>
<input id="drainTimes" type="number">
</div>
<div class="calc" id="drainCalc"></div>

<div class="row">
<label>Common area cleaning (paid by Anusha)</label>
<input id="commonAmt" type="number">
</div>

<div class="row">
<label>EB bill</label>
<input id="ebAmt" type="number">
</div>

<div class="row">
<label>Miscellaneous</label>
<input id="miscAmt" type="number">
</div>

<div class="calc" id="totalExpenseCalc"></div>
<div class="calc" id="perHouseCalc"></div>
</div>

<div class="section">
<h3>Carryover Balance</h3>
<div class="calc" id="carryCalc"></div>
</div>

<div class="section">
<h3>Kindly Transfer</h3>
<div class="row">
<label>Base amount</label>
<input id="transferAmt" type="number">
</div>
<div class="calc" id="transferCalc"></div>
</div>

<div class="section">
<h3>Budget for Next Month</h3>
<div class="calc" id="nextBudgetCalc"></div>
</div>

<button onclick="generateReport()">Generate Report</button>

</div>

<!-- ================= DEFAULT PAGE ================= -->
<div id="defaultPage" class="hidden">
<h2>Set Default Values</h2>

<div class="section">
<label>No of houses</label>
<input id="defHouses" type="number">
</div>

<div class="section">
<label>Sump water default</label>
<input id="defSump" type="number">
<label>Drainage cleaning default</label>
<input id="defDrain" type="number">
<label>Common cleaning default</label>
<input id="defCommon" type="number">
</div>

<button onclick="saveDefaults()">Save</button>
<button onclick="backMain()">Back</button>
</div>

<!-- ================= REPORT PAGE ================= -->
<div id="reportPage" class="hidden">
<button onclick="copyReport()">Copy Report</button>
<pre id="reportText"></pre>
<button onclick="backMain()">OK</button>
</div>

<script>
/* ---------- INIT ---------- */
const $ = id => document.getElementById(id);
let houses = 4;

function initMonths(){
 let sel = $("monthSelect");
 let d = new Date();
 for(let i=0;i<=12;i++){
   let dt = new Date(d.getFullYear(), d.getMonth()-i, 1);
   let opt = document.createElement("option");
   opt.value = dt.toLocaleString("default",{month:"long",year:"numeric"});
   opt.textContent = opt.value;
   sel.appendChild(opt);
 }
}

function loadDefaults(){
 houses = +localStorage.getItem("houses") || 4;
 $("budgetPerHouse").value = localStorage.getItem("budget") || 0;
 $("sumpAmt").value = localStorage.getItem("sump") || 0;
 $("drainAmt").value = localStorage.getItem("drain") || 0;
 $("commonAmt").value = localStorage.getItem("common") || 0;
}

function openDefaults(){
 $("mainPage").classList.add("hidden");
 $("defaultPage").classList.remove("hidden");
 $("defHouses").value = houses;
 $("defSump").value = $("sumpAmt").value;
 $("defDrain").value = $("drainAmt").value;
 $("defCommon").value = $("commonAmt").value;
}

function saveDefaults(){
 houses = +$("defHouses").value;
 localStorage.setItem("houses", houses);
 localStorage.setItem("sump", $("defSump").value);
 localStorage.setItem("drain", $("defDrain").value);
 localStorage.setItem("common", $("defCommon").value);
 backMain();
 loadDefaults();
}

function backMain(){
 $("defaultPage").classList.add("hidden");
 $("reportPage").classList.add("hidden");
 $("mainPage").classList.remove("hidden");
}

/* ---------- LIVE CALCULATIONS ---------- */
document.querySelectorAll("input").forEach(i=>i.oninput=calc);

function calc(){
 let bph=+$("budgetPerHouse").value;
 let prev=+$("prevBalance").value;
 let budget=(bph*houses)+prev;
 $("budgetCalc").innerText=`(${bph}*${houses}) + ${prev} = ${budget}`;

 let sump=+$("sumpAmt").value * +$("sumpTimes").value;
 $("sumpCalc").innerText=`${$("sumpAmt").value} * ${$("sumpTimes").value} = ${sump}`;

 let drain=+$("drainAmt").value * +$("drainTimes").value;
 $("drainCalc").innerText=`${$("drainAmt").value} * ${$("drainTimes").value} = ${drain}`;

 let common=+$("commonAmt").value;
 let eb=+$("ebAmt").value;
 let misc=+$("miscAmt").value;

 let total=sump+drain+common+eb+misc;
 $("totalExpenseCalc").innerText=`Total expenses = ${total}`;
 $("perHouseCalc").innerText=`Per house = ${Math.round(total/houses)}`;

 let diff=budget-total;
 let status=diff>=0?"surplus":"deficit";
 let per=Math.round(Math.abs(diff)/houses);
 $("carryCalc").innerText=`${diff} (${status}), per house ${per}`;

 let base=+$("transferAmt").value;
 let transfer= status=="deficit"? base+per : base;
 $("transferCalc").innerText=`${base} + ${status=="deficit"?per:0} = ${transfer}`;

 let next= base*houses + (status=="surplus"? per*houses:0);
 $("nextBudgetCalc").innerText=`Next month budget = ${next}`;
}

/* ---------- REPORT ---------- */
function generateReport(){
 calc();
 let m=$("monthSelect").value;
 let txt=
`Maintenance for ${m} month
Budget:
Budget in hand = (RS. ${$("budgetPerHouse").value}*${houses}) + (RS. ${$("prevBalance").value} prev month)
= Rs. ${(+$("budgetPerHouse").value*houses)+ +$("prevBalance").value}
Expenses:
sump water = ${$("sumpAmt").value} * ${$("sumpTimes").value}
= ${$("sumpCalc").innerText.split("=").pop().trim()}
Drainage cleaning = ${$("drainAmt").value} * ${$("drainTimes").value} = ${$("drainCalc").innerText.split("=").pop().trim()}
Common area cleaning =${$("commonAmt").value} (paid by Anusha)
EB bill = ${$("ebAmt").value}
Miscellaneous = ${$("miscAmt").value}
Total= ${$("totalExpenseCalc").innerText.split("=").pop().trim()}
Per house expense = ${$("totalExpenseCalc").innerText.split("=").pop().trim()} / ${houses}
=Rs. ${Math.round((+$("totalExpenseCalc").innerText.split("=").pop())/houses)}
Carryover balance for next month(surplus/ deficit)
= ${(+$("budgetPerHouse").value*houses)+ +$("prevBalance").value} - ${$("totalExpenseCalc").innerText.split("=").pop().trim()}
= ${$("carryCalc").innerText.split(",")[0].trim()} rupees
=> ${Math.abs($("carryCalc").innerText.split(",")[0])} / ${houses}
=  ${$("carryCalc").innerText.includes("surplus")?"surplus":"deficit"}
KINDLY TRANSFER:
--------------------------------
${$("transferAmt").value} + ${$("carryCalc").innerText.includes("deficit")?Math.round(Math.abs($("carryCalc").innerText.split(",")[0])/houses):0}
= ${$("transferCalc").innerText.split("=").pop().trim()} rupees per house.
_______________________________
Budget for Next month in hand.
(${ $("transferAmt").value}* ${houses}) + (${houses}*${$("carryCalc").innerText.includes("surplus")?Math.round(Math.abs($("carryCalc").innerText.split(",")[0])/houses):0})
= ${$("transferAmt").value*houses} + ${$("carryCalc").innerText.includes("surplus")?Math.round(Math.abs($("carryCalc").innerText.split(",")[0])):0}
= ${$("nextBudgetCalc").innerText.split("=").pop().trim()}
Note: Anusha needs pay ${$("transferCalc").innerText.split("=").pop().trim()-$("commonAmt").value} only.
Thanks!
`;
 $("reportText").textContent=txt;
 $("mainPage").classList.add("hidden");
 $("reportPage").classList.remove("hidden");
}

function copyReport(){
 navigator.clipboard.writeText($("reportText").textContent);
 alert("Copied");
}

/* ---------- START ---------- */
initMonths();
loadDefaults();
calc();
</script>

</body>
</html>
