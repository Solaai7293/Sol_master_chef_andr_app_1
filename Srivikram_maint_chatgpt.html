<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Apartment Maintenance Calculator</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 12px;
  background: #f5f5f5;
}
h2 { margin-top: 0; }
.section {
  background: #fff;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 6px;
}
label {
  display: block;
  font-size: 14px;
  margin-top: 6px;
}
input, select {
  width: 100%;
  padding: 6px;
  margin-top: 2px;
}
.row {
  display: flex;
  gap: 8px;
}
.row input {
  flex: 1;
}
.top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
button {
  padding: 10px;
  width: 100%;
  margin-top: 10px;
  border: none;
  border-radius: 6px;
  background: #1976d2;
  color: #fff;
  font-size: 16px;
}
.secondary {
  background: #555;
}
.hidden { display: none; }
pre {
  white-space: pre-wrap;
  background: #fff;
  padding: 10px;
  border-radius: 6px;
}
.small-btn {
  width: auto;
  padding: 6px 10px;
  font-size: 14px;
}
</style>
</head>

<body>

<!-- ================= MAIN PAGE ================= -->
<div id="mainPage">
  <div class="top-bar">
    <h2>Maintenance Calculator</h2>
    <button class="small-btn" onclick="openDefaults()">Set Default</button>
  </div>

  <div class="section">
    <label>Month</label>
    <select id="monthSelect"></select>
  </div>

  <div class="section">
    <h3>Budget</h3>
    <label>Budget per house</label>
    <input type="number" id="budgetPerHouse">
    <label>Previous balance</label>
    <input type="number" id="prevBalance">
  </div>

  <div class="section">
    <h3>Expenses</h3>

    <label>Sump water</label>
    <div class="row">
      <input type="number" id="sumpAmt">
      <input type="number" id="sumpTimes">
    </div>

    <label>Drainage cleaning</label>
    <div class="row">
      <input type="number" id="drainAmt">
      <input type="number" id="drainTimes">
    </div>

    <label>Common area cleaning (paid by Anusha)</label>
    <input type="number" id="commonCleaning">

    <label>EB bill</label>
    <input type="number" id="ebBill">

    <label>Miscellaneous</label>
    <input type="number" id="misc">
  </div>

  <div class="section">
    <label>Kindly transfer (base amount)</label>
    <input type="number" id="transferAmt">
  </div>

  <button onclick="generateReport()">Generate Report</button>
</div>

<!-- ================= DEFAULT PAGE ================= -->
<div id="defaultPage" class="hidden">
  <h2>Set Default Values</h2>

  <div class="section">
    <label>No of houses</label>
    <input type="number" id="defHouses">
  </div>

  <div class="section">
    <label>Sump water amount</label>
    <input type="number" id="defSump">

    <label>Drainage cleaning amount</label>
    <input type="number" id="defDrain">

    <label>Common area cleaning amount</label>
    <input type="number" id="defCommon">
  </div>

  <button onclick="saveDefaults()">OK</button>
  <button class="secondary" onclick="backToMain()">Back</button>
</div>

<!-- ================= REPORT PAGE ================= -->
<div id="reportPage" class="hidden">
  <button class="small-btn" onclick="copyReport()">Copy Report</button>
  <pre id="reportText"></pre>
  <button onclick="backToMain()">OK</button>
</div>

<script>
const $ = id => document.getElementById(id);

function initMonths() {
  const months = [
    "January","February","March","April","May","June",
    "July","August","September","October","November","December"
  ];
  const now = new Date();
  const prev = new Date(now.getFullYear(), now.getMonth()-1, 1);
  months.forEach((m,i)=>{
    const opt = document.createElement("option");
    opt.value = `${m} ${prev.getFullYear()}`;
    opt.textContent = `${m} ${prev.getFullYear()}`;
    if(i === prev.getMonth()) opt.selected = true;
    $("monthSelect").appendChild(opt);
  });
}

function loadDefaults() {
  $("defHouses").value = localStorage.houses || 4;
  $("defSump").value = localStorage.sumpAmt || 0;
  $("defDrain").value = localStorage.drainAmt || 0;
  $("defCommon").value = localStorage.commonAmt || 0;

  $("sumpAmt").value = localStorage.sumpAmt || 0;
  $("drainAmt").value = localStorage.drainAmt || 0;
  $("commonCleaning").value = localStorage.commonAmt || 0;
}

function openDefaults() {
  loadDefaults();
  mainPage.classList.add("hidden");
  defaultPage.classList.remove("hidden");
}

function saveDefaults() {
  localStorage.houses = $("defHouses").value;
  localStorage.sumpAmt = $("defSump").value;
  localStorage.drainAmt = $("defDrain").value;
  localStorage.commonAmt = $("defCommon").value;
  backToMain();
}

function backToMain() {
  defaultPage.classList.add("hidden");
  reportPage.classList.add("hidden");
  mainPage.classList.remove("hidden");
}

function generateReport() {
  const houses = Number(localStorage.houses || 4);

  const budgetPerHouse = Number($("budgetPerHouse").value);
  const prevBal = Number($("prevBalance").value);
  const budgetInHand = budgetPerHouse * houses + prevBal;

  const sumpTotal = $("sumpAmt").value * $("sumpTimes").value;
  const drainTotal = $("drainAmt").value * $("drainTimes").value;
  const common = Number($("commonCleaning").value);
  const eb = Number($("ebBill").value);
  const misc = Number($("misc").value);

  const totalExpense = sumpTotal + drainTotal + common + eb + misc;
  const perHouse = Math.round(totalExpense / houses);

  const diff = budgetInHand - totalExpense;
  const isSurplus = diff >= 0;
  const perPersonCarry = Math.round(Math.abs(diff) / houses);

  const baseTransfer = Number($("transferAmt").value);
  const finalTransfer = baseTransfer + (isSurplus ? 0 : perPersonCarry);

  const nextBudget = (baseTransfer * houses) + (isSurplus ? diff : 0);

  const noteAmount = finalTransfer - common;

  const report = `Maintenance for ${$("monthSelect").value} month
Budget:
Budget in hand = (RS. ${budgetPerHouse}*${houses}) + (RS. ${prevBal} prev month)
= Rs. ${budgetInHand}
Expenses:
sump water = ${$("sumpAmt").value} * ${$("sumpTimes").value}
= ${sumpTotal}
Drainage cleaning = ${$("drainAmt").value} * ${$("drainTimes").value} = ${drainTotal}
Common area cleaning =${common} (paid by Anusha)
EB bill = ${eb}
Miscellaneous = ${misc}
Total= ${totalExpense}
Per house expense = ${totalExpense} / ${houses}
=Rs. ${perHouse}
Carryover balance for next month(surplus/ deficit)
= ${budgetInHand} - ${totalExpense}
= ${Math.abs(diff)} rupees
=> ${Math.abs(diff)} / ${houses}
= ${perPersonCarry} ${isSurplus ? "surplus" : "deficit"}
KINDLY TRANSFER:
--------------------------------
${finalTransfer} + 0
= ${finalTransfer} rupees per house.
_______________________________
Budget for Next month in hand.
(${baseTransfer}* ${houses}) + (${perPersonCarry}*${houses})
= ${baseTransfer*houses} + ${isSurplus ? diff : 0}
= ${nextBudget}
Note: Anusha needs pay ${noteAmount} only.
Thanks!`;

  $("reportText").textContent = report;
  mainPage.classList.add("hidden");
  reportPage.classList.remove("hidden");
}

function copyReport() {
  navigator.clipboard.writeText($("reportText").textContent);
  alert("Report copied");
}

initMonths();
loadDefaults();
</script>
</body>
</html>
