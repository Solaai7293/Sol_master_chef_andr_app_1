<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apartment Maintenance Calculator</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  margin: 0;
  padding: 12px;
}
h2, h3 {
  margin: 6px 0;
}
.section {
  background: #ffffff;
  padding: 10px;
  margin-bottom: 12px;
  border-radius: 6px;
}
label {
  font-size: 14px;
  display: block;
  margin-top: 6px;
}
input, select {
  width: 100%;
  padding: 6px;
  margin-top: 4px;
}
.row {
  display: flex;
  gap: 6px;
}
.row input {
  flex: 1;
}
.calc {
  font-size: 13px;
  margin-top: 4px;
  color: #333;
  white-space: pre-line;
}
button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border: none;
  border-radius: 6px;
  background: #1976d2;
  color: white;
  font-size: 16px;
}
.small-btn {
  width: auto;
  padding: 6px 10px;
  font-size: 14px;
}
.secondary {
  background: #555;
}
.hidden {
  display: none;
}
pre {
  white-space: pre-wrap;
  background: white;
  padding: 10px;
  border-radius: 6px;
}
.top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
</style>
</head>

<body>

<!-- ================= MAIN PAGE ================= -->
<div id="mainPage">
  <div class="top-bar">
    <h2>Maintenance Calculator</h2>
    <button class="small-btn" onclick="openDefaults()">Set Default</button>
  </div>

  <div class="section">
    <label>Month</label>
    <select id="monthSelect" onchange="updateCalculations()"></select>
  </div>

  <div class="section">
    <h3>Budget</h3>
    <label>Budget per house</label>
    <input type="number" id="budgetPerHouse" oninput="updateCalculations()">
    <label>Previous month balance</label>
    <input type="number" id="prevBalance" oninput="updateCalculations()">
    <div id="budgetCalc" class="calc"></div>
  </div>

  <div class="section">
    <h3>Expenses</h3>

    <label>Sump water</label>
    <div class="row">
      <input type="number" id="sumpAmt" oninput="updateCalculations()">
      <input type="number" id="sumpTimes" placeholder="times" oninput="updateCalculations()">
    </div>
    <div id="sumpCalc" class="calc"></div>

    <label>Drainage cleaning</label>
    <div class="row">
      <input type="number" id="drainAmt" oninput="updateCalculations()">
      <input type="number" id="drainTimes" placeholder="times" oninput="updateCalculations()">
    </div>
    <div id="drainCalc" class="calc"></div>

    <label>Common area cleaning (paid by Anusha)</label>
    <input type="number" id="commonCleaning" oninput="updateCalculations()">
    <div id="commonCalc" class="calc"></div>

    <label>EB bill</label>
    <input type="number" id="ebBill" oninput="updateCalculations()">
    <div id="ebCalc" class="calc"></div>

    <label>Miscellaneous</label>
    <input type="number" id="misc" oninput="updateCalculations()">
    <div id="miscCalc" class="calc"></div>

    <div id="totalCalc" class="calc" style="font-weight:bold;"></div>
  </div>

  <div class="section">
    <h3>Kindly Transfer</h3>
    <label>Base amount</label>
    <input type="number" id="transferAmt" oninput="updateCalculations()">
    <div id="transferCalc" class="calc"></div>
  </div>

  <div class="section">
    <h3>Carryover & Next Month</h3>
    <div id="summaryCalc" class="calc"></div>
  </div>

  <button onclick="generateReport()">Generate Report</button>
</div>

<!-- ================= DEFAULT PAGE ================= -->
<div id="defaultPage" class="hidden">
  <h2>Set Default Values</h2>

  <div class="section">
    <label>No of houses</label>
    <input type="number" id="defHouses">
  </div>

  <div class="section">
    <label>Sump water amount</label>
    <input type="number" id="defSump">
    <label>Drainage cleaning amount</label>
    <input type="number" id="defDrain">
    <label>Common area cleaning amount</label>
    <input type="number" id="defCommon">
  </div>

  <button onclick="saveDefaults()">OK</button>
  <button class="secondary" onclick="backToMain()">Back</button>
</div>

<!-- ================= REPORT PAGE ================= -->
<div id="reportPage" class="hidden">
  <button class="small-btn" onclick="copyReport()">Copy Report</button>
  <pre id="reportText"></pre>
  <button onclick="backToMain()">OK</button>
</div>

<script>
const $ = id => document.getElementById(id);

function initMonths() {
  const now = new Date();
  for (let i = 0; i <= 12; i++) {
    const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
    const text = d.toLocaleString("default", { month: "long", year: "numeric" });
    const opt = document.createElement("option");
    opt.value = text;
    opt.textContent = text;
    if (i === 1) opt.selected = true;
    $("monthSelect").appendChild(opt);
  }
}

function loadDefaults() {
  $("defHouses").value = localStorage.houses || 4;
  $("defSump").value = localStorage.sump || 0;
  $("defDrain").value = localStorage.drain || 0;
  $("defCommon").value = localStorage.common || 0;

  $("sumpAmt").value = localStorage.sump || 0;
  $("drainAmt").value = localStorage.drain || 0;
  $("commonCleaning").value = localStorage.common || 0;
  updateCalculations();
}

function openDefaults() {
  loadDefaults();
  mainPage.classList.add("hidden");
  defaultPage.classList.remove("hidden");
}

function saveDefaults() {
  localStorage.houses = $("defHouses").value;
  localStorage.sump = $("defSump").value;
  localStorage.drain = $("defDrain").value;
  localStorage.common = $("defCommon").value;
  backToMain();
}

function backToMain() {
  defaultPage.classList.add("hidden");
  reportPage.classList.add("hidden");
  mainPage.classList.remove("hidden");
  updateCalculations();
}

function updateCalculations() {
  const houses = Number(localStorage.houses || 4);

  const bph = +$("budgetPerHouse").value || 0;
  const prev = +$("prevBalance").value || 0;
  const budget = bph * houses + prev;

  $("budgetCalc").textContent =
    `Budget in hand = (${bph}*${houses}) + (${prev} prev month)\n= Rs. ${budget}`;

  const sump = (+$("sumpAmt").value || 0) * (+$("sumpTimes").value || 0);
  const drain = (+$("drainAmt").value || 0) * (+$("drainTimes").value || 0);
  const common = +$("commonCleaning").value || 0;
  const eb = +$("ebBill").value || 0;
  const misc = +$("misc").value || 0;

  $("sumpCalc").textContent = `= ${sump}`;
  $("drainCalc").textContent = `= ${drain}`;
  $("commonCalc").textContent = `= ${common}`;
  $("ebCalc").textContent = `= ${eb}`;
  $("miscCalc").textContent = `= ${misc}`;

  const total = sump + drain + common + eb + misc;
  const perHouse = total / houses;

  $("totalCalc").textContent =
    `Total = ${total}\nPer house expense = ${total} / ${houses}\n= Rs. ${Math.round(perHouse)}`;

  const diff = budget - total;
  const carry = Math.abs(diff / houses);
  const surplus = diff >= 0;

  const base = +$("transferAmt").value || 0;
  const finalTransfer = base + (surplus ? 0 : carry);

  const nextBudget = (base * houses) + (surplus ? diff : 0);
  const anushaPay = finalTransfer - common;

  $("transferCalc").textContent =
    `${base} + ${surplus ? 0 : carry}\n= ${finalTransfer} rupees per house.`;

  $("summaryCalc").textContent =
    `Carryover balance = ${Math.abs(diff)} (${surplus ? "surplus" : "deficit"})\n` +
    `Per person carryover = ${carry}\n\n` +
    `Budget for next month = ${nextBudget}\n` +
    `Note: Anusha needs pay ${anushaPay} only.`;
}

function generateReport() {
  updateCalculations();

  const houses = Number(localStorage.houses || 4);
  const bph = +$("budgetPerHouse").value || 0;
  const prev = +$("prevBalance").value || 0;
  const budget = bph * houses + prev;

  const sumpAmt = +$("sumpAmt").value || 0;
  const sumpTimes = +$("sumpTimes").value || 0;
  const sump = sumpAmt * sumpTimes;

  const drainAmt = +$("drainAmt").value || 0;
  const drainTimes = +$("drainTimes").value || 0;
  const drain = drainAmt * drainTimes;

  const common = +$("commonCleaning").value || 0;
  const eb = +$("ebBill").value || 0;
  const misc = +$("misc").value || 0;

  const total = sump + drain + common + eb + misc;
  const perHouse = Math.round(total / houses);

  const diff = budget - total;
  const carry = Math.round(Math.abs(diff) / houses);
  const surplus = diff >= 0;

  const base = +$("transferAmt").value || 0;
  const finalTransfer = base + (surplus ? 0 : carry);
  const nextBudget = (base * houses) + (surplus ? diff : 0);
  const anushaPay = finalTransfer - common;

  $("reportText").textContent =
`Maintenance for ${$("monthSelect").value} month
Budget:
Budget in hand = (RS. ${bph}*${houses}) + (RS. ${prev} prev month)
= Rs. ${budget}
Expenses:
sump water = ${sumpAmt} * ${sumpTimes}
= ${sump}
Drainage cleaning = ${drainAmt} * ${drainTimes} = ${drain}
Common area cleaning =${common} (paid by Anusha)
EB bill = ${eb}
Miscellaneous = ${misc}
Total= ${total}
Per house expense = ${total} / ${houses}
=Rs. ${perHouse}
Carryover balance for next month(surplus/ deficit)
= ${budget} - ${total}
= ${Math.abs(diff)} rupees
=> ${Math.abs(diff)} / ${houses}
= ${carry} ${surplus ? "surplus" : "deficit"}
KINDLY TRANSFER:
--------------------------------
${base} + ${surplus ? 0 : carry}
= ${finalTransfer} rupees per house.
_______________________________
Budget for Next month in hand.
(${base}* ${houses}) + (${surplus ? carry : 0}*${houses})
= ${base * houses} + ${surplus ? diff : 0}
= ${nextBudget}
Note: Anusha needs pay ${anushaPay} only.
Thanks!`;

  mainPage.classList.add("hidden");
  reportPage.classList.remove("hidden");
}

function copyReport() {
  navigator.clipboard.writeText($("reportText").textContent);
  alert("Report copied");
}

initMonths();
loadDefaults();
</script>

</body>
</html>
