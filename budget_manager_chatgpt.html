<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Money Manager (PWA)</title>
  <meta name="description" content="Simple Money Manager PWA - open in Chrome and Add to Home screen" />
  <style>
    :root{--bg:#f6f7fb;--card:#fff;--muted:#78838f;--accent:#246bff;--income:#16a34a;--expense:#ef4444;--neutral:#6b7280}
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{margin:0;background:var(--bg);color:#0b1220}
    header.top{display:flex;align-items:center;gap:12px;padding:12px 14px;background:linear-gradient(180deg,#fff,#fbfbff);box-shadow:0 1px 0 rgba(0,0,0,.04)}
    header.sub{display:flex;align-items:center;gap:8px;padding:8px 12px;background:transparent;border-bottom:1px solid rgba(2,6,23,.04)}
    .back{width:36px;height:36px;display:grid;place-items:center;border-radius:8px;background:#fff;border:1px solid #eef2f7;cursor:pointer}
    h1.title{font-size:18px;margin:0}
    .monthNav{display:flex;align-items:center;gap:8px}
    main{padding:12px}
    .trailer{position:fixed;left:0;right:0;bottom:0;height:64px;background:#fff;display:flex;justify-content:space-around;align-items:center;border-top:1px solid rgba(2,6,23,.06)}
    .trailer button{background:transparent;border:none;display:flex;flex-direction:column;align-items:center;gap:2px;font-size:12px;color:var(--muted);cursor:pointer}
    .trailer button.active{color:var(--accent)}
    .card{background:var(--card);padding:10px;border-radius:10px;margin-bottom:10px;box-shadow:0 6px 16px rgba(2,6,23,.04)}
    .groupHeader{display:flex;justify-content:space-between;align-items:center;padding:8px}
    .txRow{display:flex;justify-content:space-between;align-items:center;padding:8px;border-top:1px solid #f4f6f8}
    .txLeft{display:flex;gap:8px;align-items:center}
    .tag{padding:6px 8px;border-radius:8px;background:#f2f7ff;border:1px solid #e7efff;font-size:13px}
    .addFab{position:fixed;right:18px;bottom:84px;width:56px;height:56px;border-radius:50%;background:var(--accent);color:#fff;display:grid;place-items:center;font-size:28px;box-shadow:0 10px 28px rgba(36,107,255,.22);cursor:pointer}

    /* editor */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:grid;place-items:end;z-index:40}
    .sheet{width:100%;max-height:88%;background:var(--card);border-top-left-radius:14px;border-top-right-radius:14px;padding:12px;overflow:auto}
    .row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
    input[type=text],input[type=number],select,input[type=date]{width:100%;padding:10px;border-radius:8px;border:1px solid #e8edf4}
    .seg{display:flex;gap:8px}
    .seg button{flex:1;padding:8px;border-radius:8px;border:1px solid #eef2f7;background:transparent;cursor:pointer}
    .seg button.active{border-color:rgba(0,0,0,.08);background:#f8fafc}
    .small{font-size:13px;color:var(--muted)}

    .listEdit{display:flex;justify-content:space-between;align-items:center;padding:8px;border-bottom:1px solid #f2f5f8}
    .inlineBtn{background:transparent;border:1px solid #eef2f7;padding:6px;border-radius:8px;cursor:pointer}

    .chart{height:220px;display:grid;place-items:center}

    @media(min-width:700px){main{max-width:720px;margin:0 auto}}
  </style>
</head>
<body>
  <header class="top">
    <div class="back" id="menuBtn">‚ò∞</div>
    <h1 class="title">Money Manager</h1>
    <div style="margin-left:auto" id="topTotals"></div>
  </header>
  <header class="sub" id="subHeader">
    <!-- second header populated per tab -->
  </header>
  <main id="main"></main>

  <div class="trailer">
    <button id="tabTx" class="active">üìÑ<div>Transactions</div></button>
    <button id="tabStats">üìä<div>Statistics</div></button>
    <button id="tabAcc">üè¶<div>Accounts</div></button>
    <button id="tabSet">‚öôÔ∏è<div>Settings</div></button>
  </div>
  <div class="addFab" id="fab">Ôºã</div>

  <!-- sheet modal -->
  <div id="modal" style="display:none" class="modal">
    <div class="sheet" id="sheet">
      <!-- content injected -->
    </div>
  </div>

<script>
// Simple SPA-like app using localStorage
const STORAGE_KEY = 'mm_recipes_v1'; // reuse key namespace
const ACC_KEY = 'mm_accounts_v1';
const CAT_KEY = 'mm_cats_v1';

let data = JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');
if(!data.tx) data.tx = []; // tx: {id,date,amount,type:'expense'|'income'|'transfer',category,subcat,account,notes}
let accounts = JSON.parse(localStorage.getItem(ACC_KEY)||'["Cash"]');
let cats = JSON.parse(localStorage.getItem(CAT_KEY)||'[{"name":"Food","subs":["Groceries","Dining"]},{"name":"Salary","subs":[]}]');

function saveAll(){localStorage.setItem(STORAGE_KEY,JSON.stringify(data));localStorage.setItem(ACC_KEY,JSON.stringify(accounts));localStorage.setItem(CAT_KEY,JSON.stringify(cats));renderTopTotals();}

// basic utils
const $=id=>document.getElementById(id);
function genId(){return 't_'+Math.random().toString(36).slice(2,9)}
function fmtDate(d){const dt=new Date(d);return dt.toLocaleDateString();}
function pad2(n){return String(n).padStart(2,'0')}
function toISODate(d){const dt=new Date(d);return dt.getFullYear()+'-'+pad2(dt.getMonth()+1)+'-'+pad2(dt.getDate())}

// initial render
const main = $('main');const subHeader = $('subHeader');const fab = $('fab');
let currentTab='tx';let txView='daily';let currentMonthOffset=0; // 0 = current month
let statsPeriod='month';

// top totals
function renderTopTotals(){const container = $('topTotals');let totInc=0,totExp=0; data.tx.forEach(t=>{if(t.type==='income') totInc+=t.amount; if(t.type==='expense') totExp+=t.amount}); const bal=totInc-totExp; container.innerHTML = `<div class='small'>Income: <strong style='color:var(--income)'>‚Çπ${totInc}</strong> Expense: <strong style='color:var(--expense)'>‚Çπ${totExp}</strong> Balance: <strong>‚Çπ${bal}</strong></div>`}
renderTopTotals();

// tabs
$('tabTx').onclick=()=>switchTab('tx');$('tabStats').onclick=()=>switchTab('stats');$('tabAcc').onclick=()=>switchTab('acc');$('tabSet').onclick=()=>switchTab('set');
function switchTab(t){currentTab=t; document.querySelectorAll('.trailer button').forEach(b=>b.classList.remove('active')); $('tab'+(t==='tx'?'Tx':t==='stats'?'Stats':t==='acc'?'Acc':'Set')).classList.add('active'); render();}

function render(){subHeader.innerHTML=''; main.innerHTML=''; if(currentTab==='tx') renderTransactions(); if(currentTab==='stats') renderStatistics(); if(currentTab==='acc') renderAccounts(); if(currentTab==='set') renderSettings();}

// TRANSACTIONS
function renderTransactions(){// sub header: daily/monthly/custom
  const seg = document.createElement('div');seg.style.width='100%';seg.innerHTML = `<div style="display:flex;gap:8px;width:100%"><button id='vDaily' class='inlineBtn'>Daily</button><button id='vMonthly' class='inlineBtn'>Monthly</button><button id='vCustom' class='inlineBtn'>Custom</button></div>`; subHeader.appendChild(seg);
  $('vDaily').onclick=()=>{txView='daily';render()};$('vMonthly').onclick=()=>{txView='monthly';render()};$('vCustom').onclick=()=>{txView='custom';render()};
  if(txView==='daily') renderDaily(); else if(txView==='monthly') renderMonthly(); else renderCustom();
}

function renderDaily(){ // header with month nav and totals
  const now = new Date(); now.setMonth(now.getMonth()+currentMonthOffset); const year=now.getFullYear(), month=now.getMonth();
  const header = document.createElement('div'); header.style.width='100%'; header.innerHTML = `<div style='display:flex;align-items:center;gap:8px;width:100%'><div class='monthNav'><button id='prevM' class='inlineBtn'>&lt;</button><div style='padding:6px 10px;border-radius:8px;background:#fff;border:1px solid #eef2f7'>${now.toLocaleString(undefined,{month:'long'})} ${year}</div><button id='nextM' class='inlineBtn'>&gt;</button></div><div style='margin-left:auto' id='monthTotals'></div></div>`; subHeader.appendChild(header);
  $('prevM').onclick=()=>{currentMonthOffset--;render();};$('nextM').onclick=()=>{currentMonthOffset++;render();};
  // gather tx in that month grouped by date desc
  const txs = data.tx.filter(t=>{const d=new Date(t.date);return d.getFullYear()===year && d.getMonth()===month});
  const groups = {};
  txs.forEach(t=>{const key = toISODate(t.date); if(!groups[key]) groups[key]=[]; groups[key].push(t)});
  // compute month totals
  let mInc=0,mExp=0; txs.forEach(t=>{if(t.type==='income') mInc+=t.amount; if(t.type==='expense') mExp+=t.amount}); $('monthTotals').textContent = `Income ‚Çπ${mInc} Expense ‚Çπ${mExp} Balance ‚Çπ${mInc-mExp}`;
  const keys = Object.keys(groups).sort((a,b)=>b.localeCompare(a)); // desc
  if(keys.length===0){main.innerHTML=`<div class='card'><div class='small'>No transactions this month</div></div>`; return}
  keys.forEach(k=>{const arr=groups[k]; const totalInc=arr.filter(x=>x.type==='income').reduce((s,x)=>s+x.amount,0); const totalExp=arr.filter(x=>x.type==='expense').reduce((s,x)=>s+x.amount,0); const c=document.createElement('div'); c.className='card'; c.innerHTML = `<div class='groupHeader'><div><strong>${new Date(k).toLocaleDateString()}</strong><div class='small'>Income ‚Çπ${totalInc} Expense ‚Çπ${totalExp}</div></div></div>`; arr.forEach(tx=>{const r=document.createElement('div');r.className='txRow'; r.innerHTML = `<div class='txLeft'><div class='tag'>${tx.category}${tx.subcat?('/'+tx.subcat):''}</div><div style='font-size:13px;color:var(--muted)'>${tx.account}</div></div><div><div style='text-align:right;font-weight:600;color:${tx.type==='income'? 'var(--income)':'var(--expense)'}'>‚Çπ${tx.amount}</div><div class='small'>${tx.notes||''}</div></div>`; r.onclick=()=>openTxView(tx.id); c.appendChild(r)}); main.appendChild(c); });
}

function renderMonthly(){ // show months of current year, each month shows weeks with totals, expand to show txs
  const now = new Date(); const year = now.getFullYear(); const header = document.createElement('div'); header.style.width='100%'; header.innerHTML = `<div style='display:flex;align-items:center;gap:8px;width:100%'><div class='monthNav'><button id='prevY' class='inlineBtn'>&lt;</button><div style='padding:6px 10px;border-radius:8px;background:#fff;border:1px solid #eef2f7'>${year}</div><button id='nextY' class='inlineBtn'>&gt;</button></div></div>`; subHeader.appendChild(header);
  $('prevY').onclick=()=>{ // change year
    const d=new Date(); d.setFullYear(d.getFullYear()-1); alert('Year navigation not implemented in demo');};
  // build months
  for(let m=0;m<12;m++){ const monthName = new Date(year,m,1).toLocaleString(undefined,{month:'long'}); const monthTx = data.tx.filter(t=>{const dt=new Date(t.date);return dt.getFullYear()===year && dt.getMonth()===m}); if(monthTx.length===0) continue; const card=document.createElement('div');card.className='card';card.innerHTML=`<div style='font-weight:600'>${monthName}</div><div class='small'>Weeks</div><div id='month_${m}'></div>`; main.appendChild(card);
    // compute weeks
    const weeks = groupByWeek(monthTx,year,m); weeks.forEach(w=>{const wk = document.createElement('div'); wk.style.borderTop='1px solid #f2f5f8'; wk.style.padding='8px'; wk.innerHTML = `<div style='display:flex;justify-content:space-between;align-items:center'><div>${w.start} ‚Üí ${w.end}</div><div>Income ‚Çπ${w.income} Expense ‚Çπ${w.expense}</div></div>`; wk.onclick=()=>{ // expand
        if(wk.dataset.expanded==='1'){wk.dataset.expanded=''; if(wk.querySelector('.txList')) wk.querySelector('.txList').remove();} else {wk.dataset.expanded='1'; const list=document.createElement('div'); list.className='txList'; list.style.marginTop='8px'; w.txs.forEach(tx=>{const r=document.createElement('div');r.className='txRow'; r.innerHTML=`<div class='txLeft'><div class='tag'>${tx.category}${tx.subcat?('/'+tx.subcat):''}</div><div class='small'>${fmtDate(tx.date)} ¬∑ ${tx.account}</div></div><div style='font-weight:600;color:${tx.type==='income'?'var(--income)':'var(--expense)'}'>‚Çπ${tx.amount}</div>`; list.appendChild(r)}); wk.appendChild(list);} }; document.getElementById('month_'+m).appendChild(wk);}); }
}

function groupByWeek(txs,year,month){ // returns array of {start,end,income,expense,txs}
  // determine all weeks in month: weeks starting Monday
  const res=[]; const first=new Date(year,month,1); const last=new Date(year,month+1,0);
  let curStart = new Date(first); // week start: Monday
  // adjust to Monday
  const day = curStart.getDay(); const diff = (day+6)%7; curStart.setDate(curStart.getDate()-diff);
  while(curStart<=last){ const s = new Date(curStart); const e = new Date(curStart); e.setDate(e.getDate()+6);
    // collect tx in this week that are within month
    const weekTx = txs.filter(t=>{const d=new Date(t.date); return d>=s && d<=e}); if(weekTx.length>0){ const income=weekTx.filter(x=>x.type==='income').reduce((a,b)=>a+b.amount,0); const expense=weekTx.filter(x=>x.type==='expense').reduce((a,b)=>a+b.amount,0); res.push({start:toISODate(s),end:toISODate(e),income,expense,txs:weekTx}); }
    curStart.setDate(curStart.getDate()+7);
  }
  return res;
}

function renderCustom(){ // calendar range + filters + list
  subHeader.innerHTML = `<div style='display:flex;gap:8px;align-items:center;width:100%'><label class='small'>From</label><input id='fromDate' type='date' /><label class='small'>To</label><input id='toDate' type='date' /><button id='applyRange' class='inlineBtn'>Apply</button></div>`;
  const container=document.createElement('div'); container.className='card'; container.innerHTML=`<div class='small'>Filter by type</div><div style='display:flex;gap:8px;margin-top:8px'><button id='fAll' class='inlineBtn'>All</button><button id='fExp' class='inlineBtn'>Expense</button><button id='fInc' class='inlineBtn'>Income</button></div><div id='customList'></div>`; main.appendChild(container);
  $('applyRange').onclick=()=>{renderCustomList();};
  renderCustomList();
}
function renderCustomList(){const f = document.querySelector('input#fromDate').value; const t = document.querySelector('input#toDate').value; const filterType = 'All'; let txs = data.tx.slice(); if(f){const fd=new Date(f); txs = txs.filter(x=>new Date(x.date)>=fd);} if(t){const td=new Date(t); txs = txs.filter(x=>new Date(x.date)<=td);} const list = $('customList'); list.innerHTML=''; if(txs.length===0){list.innerHTML='<div class=small>No records</div>';return} txs.sort((a,b)=>new Date(b.date)-new Date(a.date)); let total=0; txs.forEach(tx=>{total+=tx.amount; const r=document.createElement('div'); r.className='txRow'; r.innerHTML = `<div class='txLeft'><div class='tag'>${tx.category}${tx.subcat?('/'+tx.subcat):''}</div><div class='small'>${fmtDate(tx.date)} ¬∑ ${tx.account}</div></div><div style='font-weight:600;color:${tx.type==='income'?'var(--income)':'var(--expense)'}'>‚Çπ${tx.amount}</div>`; list.appendChild(r)}); list.insertAdjacentHTML('afterbegin',`<div class='small'>Total: ‚Çπ${total}</div>`);
}

// open transaction form
fab.onclick=()=>openTxForm();
function openTxForm(txId){ $('modal').style.display='block'; const sheet=$('sheet'); sheet.innerHTML=''; const existing = data.tx.find(x=>x.id===txId);
  // header
  const header = document.createElement('div'); header.style.display='flex'; header.style.justifyContent='space-between'; header.innerHTML = `<div style='display:flex;align-items:center;gap:8px'><div class='back' id='closeForm'>‚Üê</div><div style='font-weight:600'>${existing? 'Edit Transaction':'New Transaction'}</div></div><div class='small'> </div>`; sheet.appendChild(header); $('closeForm').onclick=()=>$('modal').style.display='none';
  // seg income/expense/transfer
  const seg = document.createElement('div'); seg.className='row'; seg.innerHTML = `<div class='seg'><button id='bExp' class='active'>Expense</button><button id='bInc'>Income</button><button id='bTr'>Transfer</button></div>`; sheet.appendChild(seg);
  const form = document.createElement('div'); form.innerHTML = `<div class='row'><label class='small'>Date</label><input id='txDate' type='date' /></div><div class='row'><label class='small'>Amount</label><input id='txAmount' type='number' inputmode='numeric' /></div><div class='row'><label class='small'>Category</label><div style='flex:1;display:flex;gap:8px'><select id='txCat'></select><button id='editCats' class='inlineBtn'>‚úèÔ∏è</button></div></div><div class='row'><label class='small'>Subcategory</label><select id='txSub'></select></div><div class='row'><label class='small'>Account</label><div style='flex:1;display:flex;gap:8px'><select id='txAcc'></select><button id='editAcc' class='inlineBtn'>‚úèÔ∏è</button></div></div><div class='row'><label class='small'>Notes</label><input id='txNotes' type='text' /></div><div style='display:flex;gap:8px;justify-content:flex-end'><button id='saveTx' class='inlineBtn'>Save</button></div>`; sheet.appendChild(form);
  // populate
  const today = new Date(); $('txDate').value = existing? toISODate(existing.date): toISODate(today);
  const catSel = $('txCat'), subSel=$('txSub'), accSel=$('txAcc'); function populateCats(){catSel.innerHTML=''; cats.forEach(c=>{const o=document.createElement('option'); o.value=c.name; o.textContent=c.name; catSel.appendChild(o)}); populateSubs(); }
  function populateSubs(){subSel.innerHTML=''; const cur = cats.find(x=>x.name===catSel.value); if(cur){ if(cur.subs.length===0){const o=document.createElement('option'); o.value=''; o.textContent='‚Äî'; subSel.appendChild(o);} else cur.subs.forEach(s=>{const o=document.createElement('option');o.value=s;o.textContent=s;subSel.appendChild(o)});} }
  function populateAccs(){accSel.innerHTML=''; accounts.forEach(a=>{const o=document.createElement('option');o.value=a;o.textContent=a;accSel.appendChild(o)})}
  populateCats(); populateAccs(); if(existing){ $('txAmount').value=existing.amount; $('txNotes').value=existing.notes||''; const type = existing.type; if(type==='income'){document.getElementById('bInc').classList.add('active');document.getElementById('bExp').classList.remove('active');} else if(type==='expense'){document.getElementById('bExp').classList.add('active');document.getElementById('bInc').classList.remove('active');} if(existing.category) catSel.value=existing.category; populateSubs(); if(existing.subcat) subSel.value=existing.subcat; if(existing.account) accSel.value=existing.account; }
  catSel.onchange=populateSubs;
  $('editCats').onclick=()=>openCategoryEditor();
  $('editAcc').onclick=()=>openAccountEditor();
  $('bExp').onclick=()=>{document.getElementById('bExp').classList.add('active');document.getElementById('bInc').classList.remove('active');}
  $('bInc').onclick=()=>{document.getElementById('bInc').classList.add('active');document.getElementById('bExp').classList.remove('active');}
  $('saveTx').onclick=()=>{ const tx = {id: existing? existing.id: genId(), date: $('txDate').value, amount: Number($('txAmount').value||0), type: document.getElementById('bInc').classList.contains('active')? 'income':'expense', category: catSel.value, subcat: subSel.value, account: accSel.value, notes: $('txNotes').value}; if(existing){ const idx = data.tx.findIndex(x=>x.id===existing.id); data.tx[idx]=tx;} else data.tx.push(tx); saveAll(); $('modal').style.display='none'; render(); }
}

// category editor
function openCategoryEditor(){ $('modal').style.display='block'; const sheet=$('sheet'); sheet.innerHTML=''; sheet.innerHTML=`<div style='display:flex;justify-content:space-between;align-items:center'><div class='back' id='closeCats'>‚Üê</div><div style='font-weight:600'>Categories</div><div><button id='addCat' class='inlineBtn'>Ôºã</button></div></div><div id='catsList' style='margin-top:8px'></div>`; $('closeCats').onclick=()=>$('modal').style.display='none'; $('addCat').onclick=()=>{ const n=prompt('New category name'); if(n){ cats.push({name:n,subs:[]}); saveAll(); renderCategoryList(); }}; renderCategoryList();}
function renderCategoryList(){ const container = $('catsList'); container.innerHTML=''; cats.forEach((c,idx)=>{ const div=document.createElement('div'); div.className='listEdit'; div.innerHTML=`<div>${c.name}</div><div><button class='inlineBtn' data-idx='${idx}' data-act='edit'>‚úèÔ∏è</button><button class='inlineBtn' data-idx='${idx}' data-act='add'>Ôºãsub</button><button class='inlineBtn' data-idx='${idx}' data-act='del'>üóëÔ∏è</button></div>`; container.appendChild(div);}); container.querySelectorAll('button').forEach(b=>{b.onclick=()=>{const i=b.dataset.idx; const act=b.dataset.act; if(act==='edit'){const nn=prompt('Rename',cats[i].name); if(nn) cats[i].name=nn; saveAll(); renderCategoryList();} if(act==='add'){const sn=prompt('Sub category name'); if(sn) {cats[i].subs.push(sn); saveAll(); renderCategoryList();}} if(act==='del'){ if(confirm('Delete category and its subs?')){cats.splice(i,1); saveAll(); renderCategoryList();}}}})

// account editor
function openAccountEditor(){ $('modal').style.display='block'; const sheet=$('sheet'); sheet.innerHTML=''; sheet.innerHTML=`<div style='display:flex;justify-content:space-between;align-items:center'><div class='back' id='closeAcc'>‚Üê</div><div style='font-weight:600'>Accounts</div><div><button id='addAcc' class='inlineBtn'>Ôºã</button></div></div><div id='accList' style='margin-top:8px'></div>`; $('closeAcc').onclick=()=>$('modal').style.display='none'; $('addAcc').onclick=()=>{ const n=prompt('New account'); if(n){accounts.push(n); saveAll(); renderAccountList(); }}; renderAccountList();}
function renderAccountList(){ const container = $('accList'); container.innerHTML=''; accounts.forEach((a,idx)=>{ const div=document.createElement('div'); div.className='listEdit'; div.innerHTML=`<div>${a}</div><div><button class='inlineBtn' data-idx='${idx}' data-act='edit'>‚úèÔ∏è</button><button class='inlineBtn' data-idx='${idx}' data-act='del'>üóëÔ∏è</button></div>`; container.appendChild(div);}); container.querySelectorAll('button').forEach(b=>{b.onclick=()=>{const i=b.dataset.idx; const act=b.dataset.act; if(act==='edit'){const nn=prompt('Rename',accounts[i]); if(nn) accounts[i]=nn; saveAll(); renderAccountList();} if(act==='del'){ if(confirm('Delete account?')){accounts.splice(i,1); saveAll(); renderAccountList();}}}})

// open tx for edit/view
function openTxView(id){ const tx = data.tx.find(x=>x.id===id); if(!tx) return; openTxForm(id); }

// STATISTICS
function renderStatistics(){ subHeader.innerHTML = `<div style='display:flex;align-items:center;gap:8px;width:100%'><div class='monthNav'><button id='sPrev' class='inlineBtn'>&lt;</button><div id='sLabel' style='padding:6px 10px;border-radius:8px;background:#fff;border:1px solid #eef2f7'></div><button id='sNext' class='inlineBtn'>&gt;</button></div><div style='margin-left:auto'><select id='periodSel'><option value='month'>Month</option><option value='year'>Year</option><option value='custom'>Custom</option></select></div></div>`;
  document.getElementById('sPrev').onclick=()=>{alert('navigate not implemented in demo')}; document.getElementById('sNext').onclick=()=>{};
  const container=document.createElement('div'); container.className='card'; container.innerHTML=`<div class='chart'><canvas id='pie'></canvas></div><div id='legend'></div>`; main.appendChild(container);
  // compute category totals for current month
  const now = new Date(); const month = now.getMonth(), year=now.getFullYear(); const txs = data.tx.filter(t=>{const d=new Date(t.date);return d.getFullYear()===year && d.getMonth()===month && t.type==='expense'});
  const totals = {}; txs.forEach(t=>{const key = t.category + (t.subcat?('/'+t.subcat):''); totals[key]=(totals[key]||0)+t.amount}); renderPie(totals);
}
function renderPie(totals){ const keys = Object.keys(totals); const vals = keys.map(k=>totals[k]); const sum = vals.reduce((a,b)=>a+b,0); const canvas = document.getElementById('pie'); if(!canvas) return; canvas.width=300; canvas.height=200; const ctx = canvas.getContext('2d'); let start=0; const colors = ['#ef4444','#f59e0b','#10b981','#3b82f6','#8b5cf6','#ec4899','#06b6d4']; keys.forEach((k,i)=>{ const v = vals[i]; const slice = v/sum; const end = start + slice*Math.PI*2; ctx.beginPath(); ctx.moveTo(150,100); ctx.arc(150,100,80,start,end); ctx.closePath(); ctx.fillStyle = colors[i%colors.length]; ctx.fill(); start=end; }); const legend = document.getElementById('legend'); legend.innerHTML=''; keys.forEach((k,i)=>{ legend.innerHTML += `<div style='display:flex;justify-content:space-between;padding:6px;border-top:1px solid #f2f5f8'><div>${k}</div><div>‚Çπ${totals[k]}</div></div>` }); }

// ACCOUNTS
function renderAccounts(){ subHeader.innerHTML = `<div style='display:flex;align-items:center;gap:8px;width:100%'><div style='font-weight:600'>Accounts</div><div style='margin-left:auto'><button class='inlineBtn' onclick='openAccountEditor()'>Edit</button></div></div>`; const c = document.createElement('div'); c.className='card'; c.innerHTML=''; accounts.forEach(a=>{ c.innerHTML += `<div style='display:flex;justify-content:space-between;padding:8px;border-top:1px solid #f2f5f8'><div>${a}</div><div class='small'>Balance: ‚Çπ0</div></div>` }); main.appendChild(c); }

// SETTINGS
function renderSettings(){ subHeader.innerHTML = `<div style='display:flex;align-items:center;gap:8px;width:100%'><div style='font-weight:600'>Settings</div></div>`; const c = document.createElement('div'); c.className='card'; c.innerHTML = `<div style='padding:8px'>Data is stored locally. Use browser menu -> Add to Home screen to install. <div style='margin-top:8px'><button onclick='exportData()' class='inlineBtn'>Export JSON</button> <button onclick='importData()' class='inlineBtn'>Import JSON</button></div></div>`; main.appendChild(c); }
function exportData(){ const blob = new Blob([JSON.stringify({data,accounts,cats})],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='mm-data.json'; a.click();}
function importData(){ const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json'; inp.onchange=(e)=>{ const f=e.target.files[0]; const r=new FileReader(); r.onload=()=>{ try{ const o=JSON.parse(r.result); data=o.data||data; accounts=o.accounts||accounts; cats=o.cats||cats; saveAll(); render(); alert('Imported'); }catch(err){alert('Invalid file')}}; r.readAsText(f)}; inp.click(); }

// start
render();

</script>
</body>
</html>