<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Apartment Maintenance Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  font-family: system-ui, Arial, sans-serif;
  background: #f2f2f2;
}

header {
  background: #1976d2;
  color: #fff;
  padding: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

header h1 {
  font-size: 18px;
  margin: 0;
}

header button {
  background: #fff;
  color: #1976d2;
  border: none;
  padding: 8px 12px;
  border-radius: 4px;
  font-weight: bold;
}

.container {
  padding: 12px;
}

.card {
  background: #fff;
  padding: 14px;
  margin-bottom: 14px;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.card h2 {
  margin-top: 0;
  font-size: 16px;
  border-bottom: 1px solid #ddd;
  padding-bottom: 6px;
}

.row {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.row label {
  flex: 1;
  font-size: 14px;
}

.row input, select {
  flex: 1;
  padding: 8px;
  font-size: 14px;
}

.calc {
  background: #eef4ff;
  padding: 8px;
  border-radius: 4px;
  font-size: 13px;
  margin-top: 6px;
}

.total {
  background: #e3f2fd;
  font-weight: bold;
}

button.primary {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  background: #1976d2;
  color: #fff;
  border: none;
  border-radius: 6px;
}

.hidden { display: none; }

pre {
  white-space: pre-wrap;
  font-family: monospace;
  background: #fff;
  padding: 14px;
  border-radius: 6px;
}

.footer-btn {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  font-size: 16px;
}
</style>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1976d2">
<link rel="apple-touch-icon" href="icon-192.png">
  
</head>

<body>

<!-- ================= MAIN PAGE ================= -->
<div id="mainPage">

<header>
<h1>Maintenance Calculator</h1>
<button onclick="openDefaults()">Set Default</button>
</header>

<div class="container">

<div class="card">
<label>Month</label>
<select id="monthSelect"></select>
</div>

<div class="card">
<h2>Budget</h2>
<div class="row">
<label>Amount per house</label>
<input id="budgetPerHouse" type="number">
</div>
<div class="row">
<label>Previous balance</label>
<input id="prevBalance" type="number">
</div>
<div class="calc" id="budgetCalc"></div>
</div>

<div class="card">
<h2>Expenses</h2>

<div class="row">
<label>Sump water amount</label>
<input id="sumpAmt" type="number">
</div>
<div class="row">
<label>No of times</label>
<input id="sumpTimes" type="number">
</div>
<div class="calc" id="sumpCalc"></div>

<div class="row">
<label>Drainage cleaning amount</label>
<input id="drainAmt" type="number">
</div>
<div class="row">
<label>No of times</label>
<input id="drainTimes" type="number">
</div>
<div class="calc" id="drainCalc"></div>

<div class="row">
<label>Common area cleaning (paid by Anusha)</label>
<input id="commonAmt" type="number">
</div>

<div class="row">
<label>EB bill</label>
<input id="ebAmt" type="number">
</div>

<div class="row">
<label>Miscellaneous</label>
<input id="miscAmt" type="number">
</div>

<div class="calc total" id="totalExpenseCalc"></div>
<div class="calc total" id="perHouseCalc"></div>
</div>

<div class="card">
<h2>Carryover Balance</h2>
<div class="calc" id="carryCalc"></div>
</div>

<div class="card">
<h2>Kindly Transfer</h2>
<div class="row">
<label>Base amount</label>
<input id="transferAmt" type="number">
</div>
<div class="calc" id="transferCalc"></div>
</div>

<div class="card">
<h2>Budget for Next Month</h2>
<div class="calc" id="nextBudgetCalc"></div>
</div>

<button class="primary" onclick="generateReport()">Generate Report</button>

</div>
</div>

<!-- ================= DEFAULT PAGE ================= -->
<div id="defaultPage" class="hidden container">
<div class="card">
<h2>Set Default Values</h2>

<div class="row">
<label>No of houses</label>
<input id="defHouses" type="number">
</div>

<div class="row">
<label>Sump water default</label>
<input id="defSump" type="number">
</div>

<div class="row">
<label>Drainage cleaning default</label>
<input id="defDrain" type="number">
</div>

<div class="row">
<label>Common cleaning default</label>
<input id="defCommon" type="number">
</div>

<button class="primary" onclick="saveDefaults()">Save</button>
<button class="footer-btn" onclick="backMain()">Back</button>
</div>
</div>

<!-- ================= REPORT PAGE ================= -->
<div id="reportPage" class="hidden container">
<button class="footer-btn" onclick="copyReport()">Copy Report</button>
<pre id="reportText"></pre>
<button class="footer-btn" onclick="backMain()">OK</button>
</div>

<script>
const $ = id => document.getElementById(id);
let houses = 4;

function initMonths(){
 let d = new Date();
 for(let i=1;i<=13;i++){
  let dt = new Date(d.getFullYear(), d.getMonth()-i, 1);
  let opt = document.createElement("option");
  opt.value = dt.toLocaleString("default",{month:"long",year:"numeric"});
  opt.textContent = opt.value;
  $("monthSelect").appendChild(opt);
 }
}

function loadDefaults(){
 houses = +localStorage.getItem("houses") || 4;
 $("budgetPerHouse").value = localStorage.getItem("budget") || 0;
 $("sumpAmt").value = localStorage.getItem("sump") || 0;
 $("drainAmt").value = localStorage.getItem("drain") || 0;
 $("commonAmt").value = localStorage.getItem("common") || 0;
}

function openDefaults(){
 mainPage.classList.add("hidden");
 defaultPage.classList.remove("hidden");
 defHouses.value = houses;
 defSump.value = sumpAmt.value;
 defDrain.value = drainAmt.value;
 defCommon.value = commonAmt.value;
}

function saveDefaults(){
 houses = +defHouses.value;
 localStorage.setItem("houses", houses);
 localStorage.setItem("sump", defSump.value);
 localStorage.setItem("drain", defDrain.value);
 localStorage.setItem("common", defCommon.value);
 backMain();
 loadDefaults();
}

function backMain(){
 mainPage.classList.remove("hidden");
 defaultPage.classList.add("hidden");
 reportPage.classList.add("hidden");
}

document.querySelectorAll("input").forEach(i=>i.oninput=calc);

function calc(){
 let bph=+budgetPerHouse.value, prev=+prevBalance.value;
 let budget=(bph*houses)+prev;
 budgetCalc.innerText=`(${bph} * ${houses}) + ${prev} = ${budget}`;

 let sump=+sumpAmt.value * +sumpTimes.value;
 sumpCalc.innerText=`${sumpAmt.value} * ${sumpTimes.value} = ${sump}`;

 let drain=+drainAmt.value * +drainTimes.value;
 drainCalc.innerText=`${drainAmt.value} * ${drainTimes.value} = ${drain}`;

 let common=+commonAmt.value, eb=+ebAmt.value, misc=+miscAmt.value;
 let total=sump+drain+common+eb+misc;
 totalExpenseCalc.innerText=`Total expenses = ${total}`;
 perHouseCalc.innerText=`Per house expense = ${Math.round(total/houses)}`;

 let diff=budget-total;
 let status=diff>=0?"surplus":"deficit";
 let per=Math.round(Math.abs(diff)/houses);
 carryCalc.innerText=`${diff} (${status}), per house = ${per}`;

 let base=+transferAmt.value;
 let transfer=status==="deficit"?base+per:base;
 transferCalc.innerText=`${base} + ${status==="deficit"?per:0} = ${transfer}`;

 let next=base*houses + (status==="surplus"?per*houses:0);
 nextBudgetCalc.innerText=`(${base} * ${houses}) + (${status==="surplus"?per*houses:0}) = ${next}`;
}

function generateReport(){
 calc();
 let m=monthSelect.value;
 let txt =
`Maintenance for ${m} month

Budget:
Budget in hand = (RS. ${budgetPerHouse.value}*${houses}) + (RS. ${prevBalance.value} prev month)
= Rs. ${(budgetPerHouse.value*houses)+ +prevBalance.value}

Expenses:
sump water = ${sumpAmt.value} * ${sumpTimes.value}
= ${sumpAmt.value*sumpTimes.value}
Drainage cleaning = ${drainAmt.value} * ${drainTimes.value} = ${drainAmt.value*drainTimes.value}
Common area cleaning =${commonAmt.value} (paid by Anusha)
EB bill = ${ebAmt.value}
Miscellaneous = ${parseInt(miscAmt.value, 10) || 0}
Total= ${totalExpenseCalc.innerText.split("=").pop().trim()}

Per house expense = ${totalExpenseCalc.innerText.split("=").pop().trim()} / ${houses}
=Rs. ${Math.round(totalExpenseCalc.innerText.split("=").pop()/houses)}

Carryover balance for next month(surplus/ deficit)
= ${(budgetPerHouse.value*houses)+ +prevBalance.value} - ${totalExpenseCalc.innerText.split("=").pop().trim()}
= ${carryCalc.innerText.split(",")[0]} rupees
=> ${Math.abs(parseInt(carryCalc.innerText.split(",")[0], 10))} / ${houses}
=  ${Math.round(Math.abs(parseInt(carryCalc.innerText.split(",")[0], 10))/houses)} ${carryCalc.innerText.includes("surplus")?"surplus":"deficit"}

KINDLY TRANSFER:
--------------------------------
${transferAmt.value} + ${carryCalc.innerText.includes("deficit")?Math.round(Math.abs(parseInt(carryCalc.innerText.split(",")[0], 10))/houses):0}
= ${Number(transferAmt.value) + (carryCalc.innerText.includes("deficit")?Math.round(Math.abs(parseInt(carryCalc.innerText.split(",")[0], 10))/houses):0)} rupees per house.
_______________________________

Budget for Next month in hand.
(${transferAmt.value}* ${houses}) + (${houses}*${carryCalc.innerText.includes("surplus")?Math.round(Math.abs(parseInt(carryCalc.innerText.split(",")[0], 10))/houses):0})
= ${transferAmt.value*houses} + ${carryCalc.innerText.includes("surplus")?Math.round(Math.abs(parseInt(carryCalc.innerText.split(",")[0], 10))):0}
= ${(transferAmt.value*houses) + (carryCalc.innerText.includes("surplus")?Math.round(Math.abs(parseInt(carryCalc.innerText.split(",")[0], 10))):0)}

Note: Anusha needs pay ${transferCalc.innerText.split("=").pop().trim()-commonAmt.value} only.

Thanks!
`;
 reportText.textContent=txt;
 mainPage.classList.add("hidden");
 reportPage.classList.remove("hidden");
}

function copyReport(){
 navigator.clipboard.writeText(reportText.textContent);
 alert("Report copied");
}

initMonths();
loadDefaults();
calc();
</script>

</body>
</html>
